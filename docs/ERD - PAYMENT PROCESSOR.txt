PAYMENT PROCESSOR - ENTITY RELATIONSHIP DIAGRAM (ERD)
=====================================================

Legend
------
- PK: Primary Key
- FK: Foreign Key
- UQ: Unique
- 1---* : one-to-many


ASCII ERD
---------

+--------------------------+               +---------------------------+
|          users           | 1 ---------*  |         accounts          |
|--------------------------|               |---------------------------|
| PK  id (UUID)            |               | PK  id (UUID)             |
| UQ  customer_id          |<--------------| FK  customer_id           |
|     first_name           |               | UQ  account_number        |
|     middle_name          |               |     currency              |
|     last_name            |               |     available_balance     |
|     dob                  |               |     ledger_balance        |
|     phone_number         |               |     status                |
|     id_type              |               |     created_at            |
|     id_number            |               |     updated_at            |
|     kyc_level            |               +---------------------------+
|     transaction_pin_hash |                              |
|     created_at           |                              | 1 ---------* (debit side)
|     updated_at           |                              v
+--------------------------+               +---------------------------+
                                           |         transfers         |
                                           |---------------------------|
                                           | PK  id (UUID)             |
                                           | UQ  payment_reference     |
                                           | UQ  transaction_reference |
                                           | FK  debit_account_number  |
                                           |     credit_account_number |
                                           |     beneficiary_bank_code |
                                           |     debit_currency        |
                                           |     credit_currency       |
                                           |     debit_amount          |
                                           |     credit_amount         |
                                           |     ccy_rate              |
                                           |     charge_amount         |
                                           |     vat_amount            |
                                           |     status                |
                                           |     audit_payload         |
                                           |     created_at            |
                                           |     updated_at            |
                                           |     processed_at          |
                                           +---------------------------+
                                                      |
                                                      | 1 ---------* 
                                                      v
                                  +--------------------------------------+
                                  | transient_account_transactions       |
                                  |--------------------------------------|
                                  | PK  id (UUID)                        |
                                  | FK  transfer_id                      |
                                  |     payment_reference                |
                                  |     entry_type (DEBIT/CREDIT)        |
                                  |     currency                         |
                                  |     amount                           |
                                  |     created_at                       |
                                  +--------------------------------------+


+--------------------------+
|          rates           |
|--------------------------|
| PK  id (BIGSERIAL)       |
| UQ  (from_currency,      |
|      to_currency,        |
|      rate_date)          |
|     from_currency        |
|     to_currency          |
|     sell_rate            |
|     buy_rate             |
|     rate_date            |
|     created_at           |
+--------------------------+

Note: `rates` currently has no FK relationship to other tables.


Relationship Summary
--------------------
1. users.customer_id -> accounts.customer_id
   - One user can have many accounts.
   - ON DELETE CASCADE from users to accounts.

2. accounts.account_number -> transfers.debit_account_number
   - One account can be debit source for many transfers.

3. transfers.id -> transient_account_transactions.transfer_id
   - One transfer can have many transient account transactions.
   - ON DELETE CASCADE from transfers to transient_account_transactions.
